---
name: plan-clarify
description: Use before EnterPlanMode to clarify requirements, identify unknowns, and ensure high-quality planning input.
allowed-tools: Read, Grep, Glob, AskUserQuestion
disable-model-invocation: true
---

# 計画前の要件明確化

EnterPlanModeの前に実行し、要件を明確化して計画の精度を高める。

## 目的

1. **不明点の洗い出し**: 前提条件、スコープ、制約を明確化
2. **粒度の判定**: タスクの複雑さに応じた計画レベルを決定
3. **質問による確認**: ユーザーに確認すべき点を特定し質問

## 明確化すべき観点

### 1. Why（なぜ）
- この変更の目的・背景は何か
- 解決したい問題は何か
- 成功の定義は何か

### 2. What（何を）
- スコープ（含むもの/含まないもの）
- 機能要件
- 非機能要件（パフォーマンス、セキュリティ等）

### 3. Constraints（制約）
- 技術的制約（既存アーキテクチャ、互換性等）
- 時間的制約
- 依存関係（他チーム、外部API等）

### 4. Unknowns（不明点）
- 調査が必要な点
- 確認が必要な前提条件
- リスクや不確実性

## 粒度の自動判定

タスクの複雑さに応じて3段階で判定:

### Quick（軽量）
**適用条件:**
- 単一ファイルの変更
- 明確な修正箇所
- 既存パターンの踏襲

**出力:**
- 変更箇所の特定
- 簡潔な実装方針
- 確認事項（あれば）

### Standard（標準）
**適用条件:**
- 複数ファイルの変更
- 新機能の追加
- 既存機能の拡張

**出力:**
- 変更ファイル一覧
- 実装ステップ
- テスト方針
- リスク・注意点

### Detailed（詳細）
**適用条件:**
- アーキテクチャへの影響
- 複数コンポーネントの連携
- 新しい設計パターンの導入

**出力:**
- 背景・問題提起
- 設計の選択肢と比較
- 詳細な実装計画
- テスト戦略
- リスクと軽減策
- 将来の拡張性

## 質問テンプレート

不明点がある場合に使用する質問パターン:

### スコープ確認
- 「〜は対象に含みますか？」
- 「〜の場合はどう扱いますか？」
- 「既存の〜との互換性は必要ですか？」

### 技術的確認
- 「〜のアプローチと〜のアプローチ、どちらが望ましいですか？」
- 「パフォーマンス要件はありますか？」
- 「エラー時の振る舞いはどうしますか？」

### 優先度確認
- 「〜と〜、どちらを優先しますか？」
- 「MVP（最小限の実装）として必要な範囲は？」

## 出力フォーマット

```markdown
# 要件明確化: {タスク名}

## 理解した内容

### 目的
{なぜこの変更が必要か}

### スコープ
**含むもの:**
- ...

**含まないもの:**
- ...

### 制約
- ...

## 粒度判定

**レベル:** Quick / Standard / Detailed

**理由:** {判定根拠}

## 確認事項

以下の点を確認させてください:

1. {質問1}
2. {質問2}
...

## 次のステップ

確認後、EnterPlanMode で詳細な実装計画を作成します。
```

## 関連

- EnterPlanMode: 本ツールの出力を入力として計画を作成
- @skills/plan/templates/format.md: 計画の出力フォーマット
